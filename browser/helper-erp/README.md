# Weekly Report - Edge浏览器插件

这是一个用于自动生成ERP周报的Edge浏览器插件，基于原有的Python脚本转换而来。

## 功能特性

- 支持多用户周报生成（默认用户：付家旺）
- 可配置的工作日选择（周一至周日）
- 自动从ERP系统获取工单数据
- 自动从任务管理系统获取任务数据
- 根据指定日期范围生成周报
- 智能数据分布（工单和任务数据均匀分布到选中的工作日）
- 数据统计显示（显示工单数、任务数和总计）
- 内容自动截断（超过200字符自动添加省略号）
- 支持一键复制到剪贴板
- 友好的用户界面
- 自定义日期选择器

## 安装方法

1. 下载或克隆此项目到本地
2. 打开Edge浏览器，进入扩展管理页面 (`edge://extensions/`)
3. 开启"开发人员模式"
4. 点击"加载解压缩的扩展"
5. 选择项目文件夹
6. 插件安装完成

## 使用方法

1. 点击浏览器工具栏中的插件图标
2. 在弹出窗口中输入要生成周报的用户名（默认为付家旺）
3. 选择要包含在周报中的工作日（默认包含周一到周五）
4. 设置开始日期和结束日期
5. 点击"生成周报"按钮
6. 等待数据获取和报告生成
7. 点击"复制到剪贴板"按钮复制生成的周报

### 用户输入说明

- **默认用户**: 付家旺
- **输入方式**: 文本输入框，支持任意用户名
- **验证**: 用户名不能为空
- **灵活性**: 可以根据实际需要输入任何有效的用户名

### 工作日配置说明

- **默认配置**: 周一到周五（工作日）
- **可选配置**: 周六、周日
- **验证**: 至少需要选择一个工作日
- **灵活性**: 可以根据实际工作安排自定义工作日

## 技术实现

### 主要文件结构

```
├── manifest.json          # 插件配置文件
├── popup/
│   ├── popup.html        # 弹出窗口界面
│   └── popup.js          # 弹出窗口逻辑
├── background/
│   └── background.js     # 后台服务脚本（包含配置）
├── content/
│   └── content_script.js # 内容脚本
└── icons/                # 插件图标
```

### 核心功能

1. **数据获取**: 通过API调用获取ERP工单和任务数据
2. **用户管理**: 支持多用户数据获取，根据用户名获取对应的工单和任务
3. **Cookie管理**: 自动获取和使用浏览器cookies进行身份验证
4. **数据处理**: 按照原有Python脚本的逻辑处理和组织数据
5. **报告生成**: 根据日期范围生成格式化的周报

### API接口

- **工单数据**: `http://tjerp.superboss.cc/wo/search`
- **任务数据**: `https://tb.raycloud.com/api/v2/projects/{projectId}/tasks`

### 用户配置

插件支持多用户数据获取，需要在`background.js`文件中配置用户ID映射：

```javascript
const USER_ID_MAP = {
  '付家旺': '612f23fd1f9f03000118a1ae',
  // 添加更多用户...
};
```

**配置说明**:
- 键名：用户名（与界面输入的用户名一致）
- 键值：对应的用户ID（从任务管理系统中获取）
- 默认用户：付家旺

### API更新说明

**任务数据API已更新**:
- 新API: `https://tb.raycloud.com/api/v2/projects/{projectId}/tasks`
- 支持更复杂的过滤条件
- 返回数据结构: `{ result: [...], nextPageToken: "", totalSize: number }`
- 项目ID: `5b757f62188bc70018b1d470`

### 内容处理说明

**智能数据分布**:
- 工单和任务数据自动均匀分布到选中的工作日
- 支持任意工作日组合（如：周一、三、五）
- 数据按工作日顺序分配，确保分布均匀
- 剩余数据优先分配给前面的工作日

**数据统计功能**:
- 生成成功后显示工单数量统计
- 显示任务数量统计
- 显示总数据条数
- 提供清晰的数据概览

**时间戳处理**:
- 自动转换为东八区时间戳
- 工单API使用毫秒级时间戳
- 任务API使用ISO 8601格式（东八区）
- 开始日期设置为00:00:00，结束日期设置为23:59:59
- 确保时间查询的准确性，包含完整日期范围

**自动截断功能**:
- 默认截断长度: 200字符
- 超过长度自动添加省略号 `...`
- 可在`background.js`中配置`maxContentLength`
- 适用于工单和任务内容

## 注意事项

1. 确保已登录相关系统（ERP和任务管理系统）
2. 插件需要访问cookies权限以获取身份验证信息
3. 网络连接正常以确保API调用成功
4. 日期格式为YYYY-MM-DD
5. 使用前请根据实际情况配置`background.js`中的用户ID映射
6. 确保用户ID与任务管理系统中的用户ID一致

## 故障排除

如果遇到问题，请检查：

1. 浏览器控制台是否有错误信息
2. 网络连接是否正常
3. 是否已正确登录相关系统
4. 插件权限是否已正确授予

## 开发说明

此插件基于Chrome Extension Manifest V3开发，兼容Edge浏览器。主要技术栈：

- HTML/CSS/JavaScript
- Chrome Extension API
- Fetch API
- Promise/async-await

## 许可证

本项目仅供学习和内部使用。
